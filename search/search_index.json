{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":""},{"location":"#overview","title":"Overview","text":""},{"location":"#t-o-s-t-a-d-a-s","title":"T O S T A D A S","text":"<p>Toolkit for Open Sequence Triage, Annotation, and DAtabase Submission</p> <p>A portable, open-source pipeline designed to streamline submission of pathogen genomic data to public repositories. Reducing barriers to timely data submission increases the value of public repositories for both public health decision making and scientific research. TOSTADAS facilitates routine sequence submission by standardizing:</p> <ul> <li>Metadata Validation</li> <li>Genome Annotation</li> <li>File submission The current release is tested with sequence data from Poxviruses and select bacteria but TOSTADAS is designed to be flexible, modular, and pathogen agnostic, allowing users to customize their submission of raw read data, assembled genomes, or both.</li> </ul>"},{"location":"#pipeline-summary","title":"Pipeline Summary","text":""},{"location":"#1-metadata-validation","title":"(1) Metadata Validation","text":"<p>Verifies that user-provided metadata conforms to NCBI standards and match the sequence data file(s), all of which are organized in an Excel spreadsheet (example file). By default, TOSTADAS uses a set of metadata fields appropriate for most pathogen genomic data submissions, but can be configured to accommodate custom metadata fields specific to any use case. A full guide to using custom metadata fields can be found here: Custom Metadata Guide</p>"},{"location":"#2-gene-annotation","title":"(2) Gene Annotation","text":"<p>Optional gene calling and feature annotation of assembled genomes (FASTA) using one of the following:</p> <p>(1) RepeatMasker + Liftoff (viral)</p> <ul> <li>Optimized for variola and mpox genomes, this workflow combines RepeatMasker for annotating repeat motifs and Liftoff to annotate functional regions. Execution requires a reference genome (FASTA) and feature list (GFF3) definition. Modifications likely necessary for use with other pathogens.</li> </ul> <p>(2) VADR (viral)</p> <ul> <li>Annotates genomes using a set of homologous reference models. TOSTADAS comes packaged with support for monkeypox virus and a full list of supported pathogens is available from VADR GitHub Repository.</li> </ul> <p>(3) Bakta (bacterial)</p> <ul> <li>Annotates bacterial genomes and plasmids using Bakta. Execution requires a reference database (found here), which can be downloaded at runtime. All annotation options produce a general feature format file (GFF) and NCBI feature table (TBL) compatible with downstream NCBI submission requirements.</li> </ul>"},{"location":"#3-submission","title":"(3) Submission","text":"<p>Prepare necessary submission files for BioSample, SRA, and/or GenBank depending on the provided inputs and perform optional upload to NCBI via ftp. This workflow was adapted from the SeqSender public database submission pipeline.</p>"},{"location":"getintouch/","title":"Get in Touch","text":"<p>If you need to report a bug, suggest new features, or just say \u201cthanks\u201d, open an issue and we\u2019ll try to get back to you as soon as possible!</p>"},{"location":"getintouch/#steps-to-open-issue-request","title":"Steps to Open Issue Request:","text":""},{"location":"getintouch/#1-select-appropriate-template","title":"(1) Select appropriate template","text":"<p>Following the link above, there are four options for issue templates and your selection will depend on (1) if you are a user vs maintainer/collaborator and (2) if the request pertains to a bug vs feature enhancement. Please select the template that accurately reflects your situation.</p>"},{"location":"getintouch/#2-fill-out-necessary-information","title":"(2) Fill out necessary information","text":"<p>Once the appropriate template has been selected, you must fill/answer all fields/questions specified. The information provided will be valuable in getting more information about the issue and any necessary context surrounding it.</p>"},{"location":"getintouch/#3-submit-the-issue","title":"(3) Submit the Issue","text":"<p>Once all information has been provided, you may now submit it!</p> <p>Please allow for some turnaround time for us to review the issue and potentially start addressing it. If this is an urgent request and have not heard from us nor see any progress being made after quite some time (longer than a week), feel free to start a discussion (found here: Start New Discussion) mentioning the following:</p> <ul> <li>Issue Number</li> <li>Date Submitted</li> <li>General Background on Bug/Feature</li> <li>Reason for Urgency</li> </ul> <p>And we will get back to you as soon as possible.</p>"},{"location":"installation/","title":"Installation","text":""},{"location":"installation/#environment-setup","title":"Environment Setup","text":""},{"location":"installation/#dependencies","title":"Dependencies:","text":"<ul> <li>Nextflow v. 21.01.03 or newer</li> <li>Compute environment (docker, singularity or conda)</li> </ul> <p>\u2757 Note: If you are a CDC user, please follow the set-up instructions found on this page: CDC User Guide</p>"},{"location":"installation/#1-clone-the-repository-to-your-local-machine","title":"(1) Clone the repository to your local machine:","text":"<ul> <li><code>git clone https://github.com/CDCgov/tostadas.git</code></li> </ul> <p>\u2757 Note: If you have mamba or nextflow installed in your local environment, you may skip steps 2, 3 (mamba installation) and 6 (nextflow installation) accordingly.</p>"},{"location":"installation/#2-install-mamba-and-add-it-to-your-path","title":"(2) Install mamba and add it to your PATH","text":"<p>2a. Install mamba</p> <p>\u2757 Note: If you have mamba installed in your local environment, skip ahead to step 3 (Create and activate a conda environment)</p> <p><code>curl -L -O https://github.com/conda-forge/miniforge/releases/latest/download</code> <code>Mambaforge-$(uname)-$(uname -m).sh</code> <code>bash Mambaforge-$(uname)-$(uname -m).sh -b -p $HOME/mambaforge</code></p> <p>2b. Add mamba to PATH:</p> <p><code>export PATH=\"$HOME/mambaforge/bin:$PATH\"</code></p>"},{"location":"installation/#3-create-and-activate-a-conda-environment","title":"(3) Create and activate a conda environment","text":"<p>3a. Create an empty conda environment to install Nextflow into</p> <p><code>conda create --name tostadas</code></p> <p>3b. Activate the environment</p> <p><code>conda activate tostadas</code></p> <p>Verify which environment is active by running the following conda command: <code>conda env list</code>. The active environment will be denoted with an asterisk <code>*</code></p>"},{"location":"installation/#4-install-nextflow-using-mamba-and-the-bioconda-channel","title":"(4) Install Nextflow using mamba and the bioconda Channel","text":""},{"location":"installation/#install-nextflow","title":"Install Nextflow","text":"<p><code>mamba install -c bioconda nextflow</code></p>"},{"location":"installation/#ensure-installation-was-successful-by-running-nextflow-with-the-v-or-version-flag","title":"Ensure installation was successful by running nextflow with the <code>-v</code> or <code>-version</code> flag","text":"<p><code>nextflow -v</code></p> <p>Expected output:</p> <p><code>nextflow version &lt;CURRENT VERSION&gt;</code></p> <p>The exact version of Nextflow returned will differ from installation to installation. It is important that the command executes successfully, and a version number is returned.</p>"},{"location":"installation/#5-update-the-default-submissions-config-file-with-your-ncbi-username-and-password-and-run-the-following-nextflow-command-to-execute-the-scripts-with-default-parameters-and-the-local-run-environment","title":"(5) Update the default submissions config file with your NCBI username and password, and run the following nextflow command to execute the scripts with default parameters and the local run environment:","text":"<p><code># update this config file (you don't have to use vim)</code> <code>vim bin/config_files/default_config.yaml</code> <code># for virus reads</code> <code>nextflow run main.nf -profile test,&lt;singularity|docker|conda&gt; --virus</code></p> <p>\u2757 Note: If you do not update the default_config.yaml file with your NCBI credentials, you will see the following command error: <code>Error:530 Login incorrect</code>.</p> <p>The outputs of the pipeline will appear in the test_output folder within the project directory. You can specify an output directory in the config file or by supplying a path to the <code>--output_dir</code> flag in your <code>nextflow run</code> command.</p>"},{"location":"outputs/","title":"Outputs","text":""},{"location":"outputs/#pipeline-overview","title":"Pipeline Overview:","text":"<p>The workflow will generate outputs in the following order:</p> <ul> <li>Validation <ul> <li>Responsible for QC of metadata</li> <li>Aligns sample metadata .xlsx to sample .fasta</li> <li>Formats metadata into .tsv format</li> </ul> </li> <li>Annotation<ul> <li>Extracts features from .gff</li> <li>Aligns features</li> <li>Annotates sample genomes outputting .gff</li> </ul> </li> <li>Submission<ul> <li>Formats for database submission</li> <li>This section runs twice, with the second run occurring after a wait time to allow for all samples to be uploaded to NCBI.</li> </ul> </li> </ul>"},{"location":"outputs/#output-directory-formatting","title":"Output Directory Formatting:","text":"<p>The outputs are recorded in the directory specified within the nextflow.config file and will contain the following:</p> <ul> <li>validation_outputs (name configurable with <code>val_output_dir</code>)<ul> <li>name of metadata sample file<ul> <li>errors</li> <li>fasta</li> <li>tsv_per_sample</li> </ul> </li> </ul> </li> <li>liftoff_outputs (name configurable with <code>final_liftoff_output_dir</code>)<ul> <li>name of metadata sample file<ul> <li>errors</li> <li>fasta</li> <li>liftoff</li> <li>tbl</li> </ul> </li> </ul> </li> <li>vadr_outputs (name configurable with <code>vadr_output_dir</code>)<ul> <li>name of metadata sample file</li> <li>errors</li> <li>fasta</li> <li>gffs</li> <li>tbl</li> </ul> </li> <li>bakta_outputs (name configurable with <code>bakta_output_dir</code>)<ul> <li>name of metadata sample file</li> <li>fasta</li> <li>gff</li> <li>tbl</li> </ul> </li> <li>submission_outputs (name and path configurable with <code>submission_output_dir</code>)<ul> <li>name of annotation results (Liftoff or VADR, etc.)<ul> <li>individual_sample_batch_info</li> <li>biosample_sra</li> <li>genbank</li> <li>accessions.csv</li> </ul> </li> <li>terminal_outputs</li> <li>commands_used</li> </ul> </li> </ul>"},{"location":"outputs/#understanding-pipeline-outputs","title":"Understanding Pipeline Outputs:","text":"<p>The pipeline outputs include:</p> <ul> <li>metadata.tsv files for each sample</li> <li>separate fasta files for each sample</li> <li>separate gff files for each sample</li> <li>separate tbl files containing feature information for each sample</li> <li>submission log file<ul> <li>This output is found in the submission_outputs file in your specified output_directory</li> </ul> </li> </ul>"},{"location":"parameters/","title":"Parameters","text":"<p>Default parameters are given in the nextflow.config file. This table lists the parameters that can be changed to a value, path or true/false. When changing these parameters pay attention to the required inputs and make sure that paths line-up and values are within range. To change a parameter you may change with a flag after the nextflow command or change them within your nextflow.config file.</p> <ul> <li>Please note the correct formatting and the default calculation of submission_wait_time at the bottom of the params table.</li> </ul>"},{"location":"parameters/#input-files","title":"Input Files","text":"Param Description Input Required --fasta_path Path to directory containing single sample fasta files Yes (path as string) --ref_fasta_path Reference Sequence file path Yes (path as string) --meta_path Meta-data file path for samples Yes (path as string) --ref_gff_path Reference gff file path for annotation Yes (path as string)"},{"location":"parameters/#run-environment","title":"Run Environment","text":"Param Description Input Required --docker_container Name of the Docker container Yes, if running with docker profile (name as string) --docker_container_vadr Name of the Docker container to run VADR annotation Yes, if running with docker profile (name as string)"},{"location":"parameters/#general-subworkflow","title":"General Subworkflow","text":"Param Description Input Required --submission Toggle for running submission Yes (true/false as bool) --annotation Toggle for running annotation Yes (true/false as bool) --cleanup Toggle for running cleanup subworkflows Yes (true/false as bool)"},{"location":"parameters/#cleanup-subworkflow","title":"Cleanup Subworkflow","text":"Param Description Input Required --clear_nextflow_log Clears nextflow work log Yes (true/false as bool) --clear_work_dir Param to clear work directory created during workflow Yes (true/false as bool) --clear_conda_env Clears conda environment Yes (true/false as bool) --clear_nf_results Remove results from nextflow outputs Yes (true/false as bool)"},{"location":"parameters/#general-output","title":"General Output","text":"Param Description Input Required --output_dir File path to submit outputs from pipeline Yes (path as string) --overwrite_output Toggle to overwriting output files in directory Yes (true/false as bool)"},{"location":"parameters/#validation","title":"Validation","text":"Param Description Input Required --val_output_dir File path for outputs specific to validate sub-workflow Yes (folder name as string) --val_date_format_flag Flag to change date output Yes (-s, -o, or -v as string) --val_keep_pi Flag to keep personal identifying info, if provided otherwise it will return an error Yes (true/false as bool) --validate_custom_fields Toggle checks/transformations for custom metadata fields on/off No (true/false as bool) --custom_fields_file Path to the JSON file containing custom metadata fields and their information  No (path as string)"},{"location":"parameters/#liftoff","title":"Liftoff","text":"Param Description Input Required --final_liftoff_output_dir File path to liftoff specific sub-workflow outputs Yes (folder name as string) --lift_print_version_exit Print version and exit the program Yes (true/false as bool) --lift_print_help_exit Print help and exit the program Yes (true/false as bool) --lift_parallel_processes # of parallel processes to use for liftoff Yes (Integer) --lift_delete_temp_files Deletes the temporary files after finishing transfer Yes (true/false as string) --lift_child_feature_align_threshold Map only if its child features align with sequence identity &gt; this value Yes (Integer) --lift_unmapped_feature_file_name Name of unmapped features file name Yes (path as string) --lift_copy_threshold Minimum sequence identity in exons/CDS for which a gene is considered a copy; must be greater than -s; default is 1.0 Yes (float) --lift_distance_scaling_factor Distance scaling factor; by default D =2.0 Yes (float) --lift_flank Amount of flanking sequence to align as a fraction of gene length Yes (float between [0.0-1.0]) --lift_overlap Maximum fraction of overlap allowed by 2 features Yes (float between [0.0-1.0]) --lift_mismatch Mismatch penalty in exons when finding best mapping; by default M=2 Yes (integer) --lift_gap_open Gap open penalty in exons when finding best mapping; by default GO=2 Yes (integer) --lift_gap_extend Gap extend penalty in exons when finding best mapping; by default GE=1 Yes (integer) --lift_infer_transcripts Use if annotation file only includes exon/CDS features and does not include transcripts/mRNA Yes (True/False as string) --lift_copies Look for extra gene copies in the target genome Yes (True/False as string) --lift_minimap_path Path to minimap if you did not use conda or pip Yes (N/A or path as string) --lift_feature_database_name Name of the feature database, if none, then will use ref gff path to construct one Yes (N/A or name as string)"},{"location":"parameters/#vadr","title":"VADR","text":"Param Description Input Required --vadr_output_dir File path to vadr specific sub-workflow outputs Yes (folder name as string) --vadr_models_dir File path to models for MPXV used by VADR annotation Yes (folder name as string)"},{"location":"parameters/#bakta","title":"BAKTA","text":"<p>Controlling Bakta within TOSTADAS uses parameters of the same name with prefix <code>--bakta_</code> as described below. For more details, visit the Bakta GitHub page.</p> Param Description Input Required --bakta_db_path Path to Bakta database if user is supplying database No (path to database) --download_bakta_db Option to download Bakta database Yes (true/false) --bakta_db_type Bakta database type (light or full) Yes (string) --bakta_output_dir File path to bakta specific sub-workflow outputs Yes (folder name as string) --bakta_min_contig_length Minimum contig size Yes (integer) --bakta_threads Number of threads to use while running annotation Yes (integer) --bakta_genus Organism genus name Yes (N/A or name as string) --bakta_species Organism species name Yes (N/A or name as string) --bakta_strain Organism strain name Yes (N/A or name as string) --bakta_plasmid Name of plasmid Yes (unnamed or name as string) --bakta_locus Locus prefix Yes (contig or name as string) --bakta_locus_tag Locus tag prefix Yes (autogenerated or name as string) --bakta_translation_table Translation table Yes (integer) --bakta_gram Gram type for signal peptide predictions No ('+' '-' '?') --bakta Toggle for running Bakta annotation Yes (true/false as bool)"},{"location":"parameters/#sample-submission","title":"Sample Submission","text":"Param Description Input Required --genbank Submit to GenBank Yes (true/false as bool) --sra Submit to SRA Yes (true/false as bool) --submission_output_dir Either name or relative/absolute path for the outputs from submission Yes (name or path as string) --submission_prod_or_test Whether to submit samples for test or actual production Yes (prod or test as string) --submission_config Configuration file for submission to public repos Yes (path as string) --submission_wait_time Calculated based on sample number (3 * 60 secs * sample_num) integer (seconds) --batch_name Name of the batch to prefix samples with during submission Yes (name as string) --send_submission_email Toggle email notification on/off Yes (true/false as bool) --req_col_config Path to the required_columns.yaml file Yes (path as string) <p>\u2757 Important note about send_submission_email: An email is only triggered if Genbank is being submitted to AND <code>table2asn</code> is the <code>genbank_submission_type</code>. As for the recipient, this must be specified within your submission config file under 'general' as 'notif_email_recipient'*</p>"},{"location":"profile/","title":"Profile Options &amp; Input Files","text":""},{"location":"profile/#input-files-required","title":"Input Files Required:","text":"<p>\u2757 Note: Currently, the pipeline does not accept input files containing period marks . in their naming convention.</p>"},{"location":"profile/#a-running-annotation-and-submission-to-genbank-and-sra","title":"(A) Running Annotation and Submission to GenBank and SRA:","text":"Input files File type Description fasta .fasta Single sample fasta sequence file(s) fastq .fastq Single sample fastq sequence file(s) metadata .xlsx Multi-sample metadata matching metadata spreadsheets provided in input_files ref_fasta .fasta Reference genome to use for the liftoff_submission branch of the pipeline ref_gff .gff Reference GFF3 file to use for the liftoff_submission branch of the pipeline submission_config .yaml configuration file for submitting to NCBI, sample versions can be found in repo <p>All annotation workflows require single sample fasta input files. Input fasta files can contain multiple contigs or chromosomes, but all sequences in the file must come from the same specimen.</p>"},{"location":"profile/#b-running-sra-submission-only","title":"(B) Running SRA Submission only:","text":"Input files File type Description fastq .fastq Single sample fastq sequence file(s) metadata .xlsx submission_config .yaml configuration file for submitting to NCBI, sample versions can be found in repo <p>\u2757 This pipeline has been tested with paired-end sequence data.</p> <p>Example metadata Link</p>"},{"location":"profile/#submitting-to-genbank","title":"Submitting to GenBank","text":"<p>The files required for GenBank submission will be stored in the <code>test_output/submission_outputs/&lt;sample_name&gt;/submission_files/GENBANK/</code> directory. You can find information on how to submit these files to NCBI here.</p>"},{"location":"profile/#customizing-parameters","title":"Customizing Parameters:","text":"<p>Parameters can be customized from the command line or by modifying one of the following configuration files: standard.json, standard.yml or nextflow.config.</p>"},{"location":"profile/#1-customizing-parameters-from-the-command-line","title":"(1) Customizing parameters from the command line:","text":"<p>Parameters can be overridden during runtime by providing various flags to the <code>nextflow</code> command.</p> <p>Example: Modifying the path of the output directory</p> <p><code>nextflow run main.nf -profile test,singularity --virus --output_dir /path/to/output/dir</code> Certain parameters such as -profile and pathogen type (<code>--virus</code>) are required, while others like <code>--output_dir</code> can be specified optionally. The complete list of parameters and the types of input that they require can be found in the Parameters page.</p>"},{"location":"profile/#2-customizing-parameters-by-modifying-the-standardjson-or-standardyml-files","title":"(2) Customizing parameters by modifying the standard.json or standard.yml files:","text":"<p>Default parameters can be overridden by making changes to either the standard.yml or standard.json files located in the ./params directory. To modify the run with the updated parameters, use the <code>--params-file</code> runtime parameter and specify which file contains the updated parameters.</p> <p>Example:</p> <p><code>nextflow run main.nf -profile test,singularity --virus -params-file &lt;standard_params.yml or standard_params.json&gt;</code></p>"},{"location":"profile/#3-customizing-parameters-by-modifying-the-nextflowconfig-file","title":"(3) Customizing parameters by modifying the nextflow.config file:","text":"<p>Default parameters can be also be overridden by making changes to the nextflow.config file located in the project directory. By default, if the test option is not provided during runtime, the run configuration will be read from the nextflow.config file.</p>"},{"location":"profile/#understanding-profiles-and-environments","title":"Understanding Profiles and Environments:","text":"<p>Within the nextflow pipeline the <code>-profile</code> parameter is required to specify the computing environment of the run. The options of <code>docker</code>, <code>singularity</code> or <code>conda</code> can passed in. The conda environment is less stable than the docker or singularity. We recommend you choose docker or singularity when running the pipeline.</p> <p>Optionally, the <code>test</code> option can be specified in the <code>-profile</code> parameter. If test is not specified, parameters are read from the nextflow.config file. The test params should remain the same for testing purposes.</p>"},{"location":"profile/#running-with-annotation-and-submission","title":"Running with Annotation and Submission:","text":"<p>You will want to define whether to run the full pipeline with submission or without submission using the <code>--submission</code> and <code>--annotation</code> flags. By default the pipeline will run both sub-workflows and submit to submit to GenBank and SRA. If you want to submit to only SRA, specify <code>--genbank false --sra</code>.</p> <p><code>nextflow run main.nf -profile &lt;singularity/docker/conda&gt; --virus --genbank --sra --submission_wait_time 5</code></p>"},{"location":"profile/#running-submission-only","title":"Running Submission only:","text":"<p>You will want to define whether to run the full pipeline with submission or without submission using the <code>--submission</code> and <code>--annotation</code> flags. By default, the pipeline will run both sub-workflows. To only run the submission sub-workflow, specify <code>--annotation false</code>.  By default the pipeline will submit to GenBank and SRA. If you want to submit to only SRA, specify <code>--genbank false --sra</code>.</p> <p>\u2757 Note: you can only submit raw files to SRA, not to Genbank.</p> <p><code>nextflow run main.nf -profile &lt;test,standard&gt;,&lt;singularity,docker&gt; --&lt;virus,bacteria&gt; --annotation false --sra --submission_wait_time 5</code></p>"},{"location":"profile/#submission-pre-requisites","title":"Submission Pre-requisites:","text":"<p>The submission component of the pipeline is adapted from SeqSender public database submission pipeline. It has been developed to allow the user to create a config file to select which databases they would like to upload to and allows for any possible metadata fields by using a YAML to pair the database's metadata fields with your personal metadata field columns. The requirements for this portion of the pipeline to run are listed below.</p> <p>(A) Create Appropriate Accounts as needed for the SeqSender public database submission pipeline integrated into TOSTADAS:</p> <ul> <li> <p>NCBI: If uploading to NCBI archives such as BioSample/SRA/Genbank, you must complete the following steps:</p> <ul> <li>Create a center account: Contact the following e-mail for account creation: sra@ncbi.nlm.nih.gov  and provide the following information:<ul> <li>Suggested center abbreviation (16 char max)</li> <li>Center name (full), center URL &amp; mailing address (including country and postcode)</li> <li>Phone number (main phone for center or lab)</li> <li>Contact person (someone likely to remain at the location for an extended time)</li> <li>Contact email (ideally a service account monitored by several people)</li> <li>Whether you intend to submit via FTP or command line Aspera (ascp)</li> </ul> </li> <li>Gain access to an upload directory: Following center account creation, a test area and a production area will be created. Deposit the XML file and related data files into a directory and follow the instructions SRA provides via email to indicate when files are ready to trigger the pipeline.</li> <li>GISAID: GISAID support is not yet implemented but it may be added in the future.</li> </ul> </li> </ul> <p>(B) Config File Set-up:</p> <ul> <li>The template for the submission config file can be found in bin/default_config_files within the repo. This is where you can edit the various parameters you want to include in your submission. Read more at the SeqSender docs.</li> <li>You can find more information on how to setup your own submission config and additional information on fields in the following guide: Submission Config Guide.</li> </ul>"},{"location":"quickstart/","title":"Quick Start","text":""},{"location":"quickstart/#validate-environment","title":"Validate Environment","text":""},{"location":"quickstart/#1-check-that-you-are-in-the-directory-where-the-tostadas-repository-was-installed-by-running-pwd","title":"(1) Check that you are in the directory where the TOSTADAS repository was installed by running <code>pwd</code>","text":"<p>Expected Output:</p> <p><code>/path/to/working/directory/tostadas</code></p>"},{"location":"quickstart/#2-change-the-submission_config-parameter-within-nextflowconfig-to-the-location-of-your-personal-submission-config-file","title":"(2) Change the submission_config parameter within nextflow.config to the location of your personal submission config file.","text":"<p>Bacterial and viral submission configurations are provided in the repo for testing purposes, but you will not be able to perform a submission without providing a personal submission configuration.</p> <p>More information on running the submission sub-workflow can be found here: More Information on Submission</p>"},{"location":"quickstart/#pipeline-execution-examples","title":"Pipeline Execution Examples","text":"<p>We describe a few use-cases of the pipeline below. For more information on input parameters, refer to the documentation found in the following pages:</p> <ul> <li>Profile Options and Input Files</li> <li>Parameters</li> </ul> <p>\u2757 The paths to the required files must be specified in the nextflow.config file or the params.yaml file.</p>"},{"location":"quickstart/#basic-usage","title":"Basic Usage:","text":"<p>Before we dive into the more complex use-cases of the pipeline, let's look at the most basic way the pipeline can be run:</p> <p><code>nextflow run main.nf -profile &lt;test(optional)&gt;,&lt;singularity|docker|conda&gt; --&lt;virus|bacteria&gt;</code> <code>-profile &lt;test(optional)&gt;,&lt;singularity|docker|conda&gt;</code> Specify the run-time environment (singularity, docker or conda). The conda implementation is less stable so using singularity or docker is recommended if available on your system. You may specify the optional <code>-profile</code> argument <code>test</code> to force the pipeline to ignore the custom configuration found in your nextflow.config file and instead run using a pre-configured test data set and configuration. <code>--&lt;virus|bacteria&gt;</code>: The pathogen type must be specified for the pipeline to run.</p> <p>\u2757 Important note on arguments: Arguments with a single \u201c-\u201c, such as -profile, are arguments to nextflow. Arguments with a double \u201c--\u201c, such as --virus or \u2013-bacteria are arguments to the TOSTADAS pipeline.</p> <p>Example:</p> <p><code>nextflow run main.nf -profile test,singularity --virus</code></p>"},{"location":"quickstart/#breakdown","title":"Breakdown:","text":"<ul> <li><code>-profile test,singularity</code><ul> <li>Set compute environment to singularity</li> <li>Run with test configuration</li> </ul> </li> <li>--virus<ul> <li>Viral sample Overriding parameters through the command line: Any parameter defined in nexflow.config can be overridden at runtime by providing the parameter as a command line argument with the \u201c--\u201d prefix.</li> </ul> </li> </ul>"},{"location":"quickstart/#example-modifying-the-output-directory","title":"Example: Modifying the output directory","text":"<p>By default, the pipeline will create and store pipeline outputs in the test_output directory. You can modify the location output files are stored by adding the <code>--output_dir</code> flag to the command line and providing the new path as a string.</p> <p><code>nextflow run main.nf -profile test,singularity \u2013-virus --output_dir &lt;/path/to/output/dir&gt;</code></p>"},{"location":"quickstart/#running-annotation-and-submission","title":"Running Annotation and Submission","text":""},{"location":"quickstart/#1-annotate-viral-assemblies-and-submit-them-to-genbank-and-sra","title":"(1) Annotate viral assemblies and submit them to GenBank and SRA","text":"<p>Database targets are specified at run time. You can specify more than one target by adding additional arguments to the command line.</p> <p><code>nextflow run main.nf -profile singularity --virus --annotation --submission --genbank --sra --meta_path &lt;/path/to/meta_data/file&gt; \u2013-fastq_path &lt;/path/to/fastq/file/directory&gt; --fasta_path &lt;/path/to/fasta/file/directory&gt;</code></p>"},{"location":"quickstart/#breakdown_1","title":"Breakdown:","text":"<ul> <li><code>-profile singularity</code><ul> <li>Set compute environment to singularity</li> </ul> </li> <li><code>--virus</code><ul> <li>Viral sample</li> </ul> </li> <li><code>--sra</code><ul> <li>Prepare an SRA submission</li> </ul> </li> <li><code>--genbank</code><ul> <li>Prepare a GenBank submission</li> </ul> </li> <li><code>--annotation</code><ul> <li>Run annotation</li> </ul> </li> <li><code>--submission</code><ul> <li>Run submission</li> </ul> </li> <li><code>--fasta_path</code><ul> <li>Provide path to directory containing your fasta files</li> </ul> </li> <li><code>--fastq_path</code><ul> <li>Provide path to directory containing your fastq files</li> </ul> </li> <li><code>--meta_path</code><ul> <li>Provide path to your meta-data file</li> </ul> </li> </ul>"},{"location":"quickstart/#2-annotate-bacterial-assemblies-and-submit-to-genbank-and-sra","title":"(2) Annotate bacterial assemblies and submit to GenBank and SRA","text":"<p>\u2757 Note \u2013 If you don\u2019t have the BAKTA database, run with the <code>--download_bakta_db true</code> flag or download from it from this Link. If you do have the database, skip ahead to (B).</p>"},{"location":"quickstart/#a-download-bakta-database","title":"(A) Download Bakta database","text":"<p><code>nextflow run main.nf -profile singularity --bacteria --genbank --sra --download_bakta_db true --bakta_db_type &lt;light|full&gt; --submission \u2013annotation --meta_path /path/to/meta_data/file \u2013fastq_path /path/to/fastq/file/directory --fasta_path /path/to/fasta/file/directory</code></p>"},{"location":"quickstart/#b-provide-path-to-existing-bakta-database","title":"(B) Provide path to existing Bakta database","text":"<p><code>nextflow run main.nf -profile singularity \u2013-bacteria \u2013\u2013annotation --submission -\u2013genbank --sra --bakta_db_path &lt;path/to/bakta/db&gt; --meta_path &lt;/path/to/meta_data/file&gt; --fastq_path &lt;/path/to/fastq/file/directory&gt; --fasta_path &lt;/path/to/fasta/file/directory&gt;</code></p>"},{"location":"quickstart/#breakdown_2","title":"Breakdown:","text":"<ul> <li><code>--bacteria</code><ul> <li>Bacterial sample</li> </ul> </li> <li><code>--download_bakta_db true</code><ul> <li>Download or refresh the Bakta database</li> </ul> </li> <li><code>--bakta_db_type &lt;light|full&gt;</code><ul> <li>Choose between the faster, lighter-weight light Bakta database or the larger and slower, but more accurate, full Bakta database</li> </ul> </li> <li><code>--bakta_db_path &lt;/path/to/bakta/db&gt;</code><ul> <li>The path to the Bakta database</li> </ul> </li> </ul>"},{"location":"quickstart/#use-case-2-running-submission-only-without-annotation","title":"Use Case 2: Running Submission only without Annotation","text":"<p>\u2757 Note: you can only submit raw files to SRA, not to Genbank.</p>"},{"location":"quickstart/#1-submit-fastqs-to-sra","title":"(1) Submit fastqs to SRA","text":"<p><code>nextflow run main.nf -profile singularity --virus --annotation false --sra \u2013submission --meta_path &lt;/path/to/meta_data/file&gt; --fastq_path &lt;/path/to/fastq/file/directory&gt;</code> <code>--annotation false</code> Disable annotation</p>"},{"location":"userguide/","title":"CDC User Guide","text":""},{"location":"userguide/#environment-setup","title":"Environment Setup","text":""},{"location":"userguide/#1-clone-the-repository-to-your-local-machine","title":"(1) Clone the repository to your local machine:","text":"<p><code>git clone https://github.com/CDCgov/tostadas.git</code> <code>cd tostadas</code></p>"},{"location":"userguide/#2-load-the-nextflow-module","title":"(2) Load the Nextflow module:","text":"<p>Initialize the nextflow module by running the following command:</p> <p><code>ml nextflow</code></p>"},{"location":"userguide/#3-ensure-that-nextflow-is-available-by-running-nextflow-v","title":"(3) Ensure that Nextflow is available by running nextflow -v","text":"<p>Expected Output:</p> <p><code>nextflow version &lt;CURRENT VERSION&gt;</code></p>"},{"location":"userguide/#4-update-the-default-submissions-config-file-with-your-ncbi-username-and-password-and-run-one-of-the-following-nextflow-commands-to-execute-the-scripts-with-default-parameters-and-the-local-run-environment","title":"(4) Update the default submissions config file with your NCBI username and password, and run one of the following nextflow commands to execute the scripts with default parameters and the local run environment:","text":"<p><code># update this config file (you don't have to use vim)</code> <code>vim bin/config_files/default_config.yaml</code> <code># for virus reads</code> <code>nextflow run main.nf -profile test,&lt;singularity/docker/conda&gt; --virus</code> The outputs of the pipeline will appear in the <code>test_output</code> folder within the project directory. You can specify an output directory in the config file or by supplying a path to the <code>--output_dir</code> flag in your <code>nextflow run</code> command.</p>"}]}